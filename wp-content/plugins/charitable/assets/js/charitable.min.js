CHARITABLE=window.CHARITABLE||{};(function(exports,$){var Donation_Form=function(form){this.errors=[];this.pending_processes=[];this.form=form;this.pause_processing=false;this.submit_processing=false;this.total=0;this.prevent_scroll_to_top=false;var self=this;var $body=$("body");var on_click_terms=function(){self.form.find(".charitable-terms-text").addClass("active");return false};var on_focus_custom_amount=function(){$(this).closest("li").trigger("click").find("input[name=donation_amount]").prop("checked",true).trigger("change");self.form.off("focus","input.custom-donation-input",on_focus_custom_amount);$(this).focus();self.form.on("focus","input.custom-donation-input",on_focus_custom_amount)};var trigger_amount_change_events=function(){$body.trigger("charitable:form:amount:changed",self);$body.trigger("charitable:form:total:changed",self)};var on_change_custom_donation_amount=function(){var unformatted=self.unformat_amount($(this).val());if($.trim(unformatted)>0){$(this).val(self.format_amount(unformatted))}trigger_amount_change_events()};var on_select_donation_amount=function(){var $li=$(this).closest("li");if($li.hasClass("selected")){return}$li.parents(".charitable-donation-form").find(".donation-amount.selected").removeClass("selected");$li.addClass("selected").find("[name=donation_amount]").prop("checked",true);if($li.hasClass("custom-donation-amount")){$li.find("input.custom-donation-input").focus()}trigger_amount_change_events()};var on_change_payment_gateway=function(){var selectedGateway=$(this).val();self.hide_inactive_payment_methods();self.show_active_payment_methods(selectedGateway);if(selectedGateway==="square"||selectedGateway==="square_core"){setTimeout((function(){window.dispatchEvent(new Event("resize"))}),100)}};var on_click_change_amount_link=function(){$(this).parent().addClass("charitable-hidden")};var on_submit=function(event){var helper=event.data.helper;if(helper.submit_processing){return false}helper.submit_processing=true;helper.show_processing();if(false===helper.validate()){helper.cancel_processing();return false}if(false!==helper.pause_processing){return false}if(1!==helper.form.data("use-ajax")){return true}maybe_process(helper,(function(){$body.trigger("charitable:form:process",helper)}));return false};var maybe_process=function(helper,callback){if(!helper.waiting()){if(helper.get_errors().length>0){helper.cancel_processing()}else{callback()}return}setTimeout(maybe_process,500,helper,callback)};var process_donation=function(event,helper){var data=helper.get_data();var form=helper.form;data.action="make_donation";data.form_action=data.charitable_action;delete data.charitable_action;$.ajax({type:"POST",data:data,dataType:"json",url:CHARITABLE_VARS.ajaxurl,timeout:0,xhrFields:{withCredentials:true},success:function(response){$body.trigger("charitable:form:processed",[response,helper]);if(response.success){maybe_process(helper,(function(){window.location.href=response.redirect_to}))}else{helper.cancel_processing(response.errors);if(response.donation_id){helper.set_donation_id(response.donation_id)}}}}).fail((function(response,textStatus,errorThrown){if(window.console&&window.console.log){console.log(response)}helper.cancel_processing([CHARITABLE_VARS.error_unknown])}));return false};var init=function(){self.form.on("click",".donation-amount",on_select_donation_amount);self.form.on("focus","input.custom-donation-input",on_focus_custom_amount);self.form.on("click",".charitable-terms-link",on_click_terms);self.form.on("blur",".custom-donation-input",on_change_custom_donation_amount);self.form.find(".donation-amount input:checked").each((function(){$(this).closest("li").addClass("selected")}));if(self.get_all_payment_methods().length){self.hide_inactive_payment_methods();self.form.on("change","#charitable-gateway-selector input[name=gateway]",on_change_payment_gateway)}self.form.on("click",".change-donation",on_click_change_amount_link);self.form.on("submit",{helper:self},on_submit);if(false===CHARITABLE.forms_initialized){$body.on("charitable:form:process",process_donation);$body.trigger("charitable:form:initialize",self);CHARITABLE.forms_initialized=true}$body.trigger("charitable:form:loaded",self)};init()};Donation_Form.prototype.get_input=function(field){return this.form.find("[name="+field+"]")};Donation_Form.prototype.get_email=function(){return this.form.find("[name=email]").val()};Donation_Form.prototype.is_recurring_donation=function(){var recurring=this.form.find("[name=recurring_donation]:checked, [name=recurring_donation][type=hidden]");return recurring.length&&"once"!==recurring.val()};Donation_Form.prototype.get_suggested_amount=function(){return accounting.unformat(this.form.find("[name=donation_amount]:checked, input[type=hidden][name=donation_amount]").val(),CHARITABLE_VARS.currency_format_decimal_sep)};Donation_Form.prototype.get_custom_amount=function(){var input=this.form.find(".charitable-donation-options.active input.custom-donation-input,.charitable-donation-options.active input.custom-donation-amount");if(0===input.length){input=this.form.find("input.custom-donation-input")}return accounting.unformat(input.val(),CHARITABLE_VARS.currency_format_decimal_sep)};Donation_Form.prototype.get_subtotal=function(){return this.get_suggested_amount()||this.get_custom_amount()};Donation_Form.prototype.get_amount=function(){this.total=this.get_subtotal();this.form.trigger("charitable:form:get_amount",this);return this.total};Donation_Form.prototype.add_amount=function(add){this.total+=add};Donation_Form.prototype.remove_amount=function(remove){this.total-=remove};Donation_Form.prototype.get_description=function(){return this.form.find("[name=description]").val()||""};Donation_Form.prototype.get_cc_number=function(){return this.form.find("#charitable_field_cc_number input").val()||""};Donation_Form.prototype.get_cc_cvc=function(){return this.form.find("#charitable_field_cc_cvc input").val()||""};Donation_Form.prototype.get_cc_expiry_month=function(){return this.form.find("#charitable_field_cc_expiration select.month").val()||""};Donation_Form.prototype.get_cc_expiry_year=function(){return this.form.find("#charitable_field_cc_expiration select.year").val()||""};Donation_Form.prototype.clear_cc_fields=function(){this.form.find("#charitable_field_cc_number input, #charitable_field_cc_name input, #charitable_field_cc_cvc input, #charitable_field_cc_expiration select").removeAttr("name")};Donation_Form.prototype.get_payment_method=function(){return this.form.find("[type=hidden][name=gateway], [name=gateway]:checked").val()||""};Donation_Form.prototype.get_all_payment_methods=function(){return this.form.find("#charitable-gateway-selector input[name=gateway]")};Donation_Form.prototype.hide_inactive_payment_methods=function(){var active=this.get_payment_method();var fields=this.form.find(".charitable-gateway-fields[data-gateway!="+active+"]");fields.hide();fields.find("input[required],select[required],textarea[required]").attr("data-required",1).attr("required",false)};Donation_Form.prototype.show_active_payment_methods=function(active){var active=active||this.get_payment_method();var fields=this.form.find(".charitable-gateway-fields[data-gateway="+active+"]");fields.show();fields.find("[data-required]").attr("required",true)};Donation_Form.prototype.format_amount=function(price,symbol){if(typeof symbol==="undefined")symbol="";return accounting.formatMoney(price,{symbol:symbol,decimal:CHARITABLE_VARS.currency_format_decimal_sep,thousand:CHARITABLE_VARS.currency_format_thousand_sep,precision:CHARITABLE_VARS.currency_format_num_decimals,format:CHARITABLE_VARS.currency_format}).trim()};Donation_Form.prototype.unformat_amount=function(price){return Math.abs(parseFloat(accounting.unformat(price,CHARITABLE_VARS.currency_format_decimal_sep)))};Donation_Form.prototype.add_error=function(message){this.errors.push(message)};Donation_Form.prototype.get_errors=function(){return this.errors};Donation_Form.prototype.get_error_message=function(){return this.errors.join(" ")};Donation_Form.prototype.print_errors=function(errors){var e=errors||this.errors,i=0,count=e.length,output="",error_notice_donation_display=typeof CHARITABLE_VARS.error_notice_donation_display==="undefined"?"top":CHARITABLE_VARS.error_notice_donation_display;if(0===count){return}if(this.form.find(".charitable-form-errors").length){this.form.find(".charitable-form-errors").remove()}output+='<div class="charitable-form-errors charitable-notice"><ul class="errors"><li>';output+=e.join("</li><li>");output+="</li></ul></div>";if(error_notice_donation_display==="bottom"){this.form.append(output)}else{this.form.prepend(output)}};Donation_Form.prototype.clear_errors=function(){this.errors=[];if(this.form.find(".charitable-form-errors").length){this.form.find(".charitable-form-errors").remove()}};Donation_Form.prototype.waiting=function(){return this.pending_processes.length>0};Donation_Form.prototype.add_pending_process=function(process){var index=this.pending_processes.indexOf(process);return-1===index?this.pending_processes.push(process)-1:index};Donation_Form.prototype.remove_pending_process=function(index){this.pending_processes.splice(index,1)};Donation_Form.prototype.remove_pending_process_by_name=function(process){var index=this.pending_processes.indexOf(process);return-1!==index&&this.remove_pending_process(index)};Donation_Form.prototype.show_processing=function(){this.form.find(".charitable-form-processing").show();this.form.find('button[name="donate"]').hide()};Donation_Form.prototype.hide_processing=function(){this.form.find(".charitable-form-processing").hide();this.form.find('button[name="donate"]').show();this.submit_processing=false;this.pause_processing=false};Donation_Form.prototype.scroll_to_top=function(){if(this.prevent_scroll_to_top){this.prevent_scroll_to_top=false;return}var $modal=this.form.parents(".charitable-modal");if($modal.length){$modal.scrollTop(0)}else{window.scrollTo(this.form.offset().left,this.form.offset().top)}};Donation_Form.prototype.cancel_processing=function(errors){this.hide_processing();this.print_errors(errors);var error_notice_donation_display=typeof CHARITABLE_VARS.error_notice_donation_display==="undefined"?"top":CHARITABLE_VARS.error_notice_donation_display;if(""===error_notice_donation_display||"top"===error_notice_donation_display){this.scroll_to_top()}this.form.trigger("charitable:form:cancelled",this)};Donation_Form.prototype.set_donation_id=function(donation_id){this.form.find("[name=ID]").val(donation_id)};Donation_Form.prototype.get_data=function(){return this.form.serializeArray().reduce((function(obj,item){if("[]"===item.name.slice(-2)){var name=item.name.slice(0,-2);if(!obj.hasOwnProperty(name)){obj[name]=[]}obj[name].push(item.value)}else{obj[item.name]=item.value}return obj}),{})};Donation_Form.prototype.get_required_fields=function(){var fields=this.form.find(".charitable-fieldset .required-field").not("#charitable-gateway-fields .required-field"),method=this.get_payment_method();if(""!==method){var gateway_fields=this.form.find("[data-gateway="+method+"] .required-field");if(gateway_fields.length){fields=$.merge(fields,gateway_fields)}}return fields};Donation_Form.prototype.subtotal_exceeds_maximum=function(){return""!==CHARITABLE_VARS.maximum_donation&&this.get_subtotal()>parseFloat(CHARITABLE_VARS.maximum_donation)};Donation_Form.prototype.is_valid_amount=function(){var minimum=parseFloat(CHARITABLE_VARS.minimum_donation);if(this.subtotal_exceeds_maximum()){return false}return minimum>0||CHARITABLE_VARS.permit_0_donation?this.get_subtotal()>=minimum:this.get_subtotal()>minimum};Donation_Form.prototype.validate_amount=function(){if(false===this.is_valid_amount()){if(this.get_subtotal()>0&&this.subtotal_exceeds_maximum()){this.add_error(CHARITABLE_VARS.error_max_exceeded)}else{this.add_error(CHARITABLE_VARS.error_invalid_amount)}return false}return true};Donation_Form.prototype.validate_required_fields=function(){var has_all_required_fields=true;this.get_required_fields().each((function(){if(""===$(this).find("input, select, textarea").val()){has_all_required_fields=false}}));if(!has_all_required_fields){this.add_error(CHARITABLE_VARS.error_required_fields)}return has_all_required_fields};Donation_Form.prototype.validate=function(){this.clear_errors();this.validate_amount();this.validate_required_fields();this.form.trigger("charitable:form:validate",this);return this.errors.length===0};exports.Donation_Form=Donation_Form})(CHARITABLE,jQuery);(function(exports,$){var Toggle=function(){var hide_target=function(){get_target($(this)).addClass("charitable-hidden")};var get_target=function($el){var target=$el.data("charitable-toggle");if(target[0]!=="."&&target[0]!=="#"){target="#"+target}return $(target)};var on_toggle=function(){var $this=$(this),$target=get_target($this);$target.toggleClass("charitable-hidden",function(){if($this.is(":checkbox")){return!$this.is(":checked")}return false===$target.hasClass("charitable-hidden")}());return false};var init=function(){$("[data-charitable-toggle]").each(hide_target)};$("body").on("click","[data-charitable-toggle]",on_toggle);if(exports.content_loading){var timer=setInterval((function(){if(false===exports.content_loading){init();clearInterval(timer)}}),500)}return init};exports.Toggle=Toggle()})(CHARITABLE,jQuery);CHARITABLE.VersionCompare=function(version,compare){compare=compare||CHARITABLE_VARS.version;if(typeof version+typeof compare!="stringstring")return false;var a=version.split("."),b=compare.split("."),i=0,len=Math.max(a.length,b.length);for(;i<len;i++){if(a[i]&&!b[i]&&parseInt(a[i])>0||parseInt(a[i])>parseInt(b[i])){return 1}else if(b[i]&&!a[i]&&parseInt(b[i])>0||parseInt(a[i])<parseInt(b[i])){return-1}}return 0};(function(exports,$){CHARITABLE.ResetSuggestedDonations=function(){if($(".charitable-donation-options").length=0){return false}$('ul.donation-amounts input[type="radio"]').each((function(){if($(this).is(":checked")){$(this).closest("li").addClass("selected")}else{$(this).closest("li").removeClass("selected")}}))}})(CHARITABLE,jQuery);(function($){CHARITABLE.forms_initialized=false;$(document).ready((function(){$("html").addClass("js");var forms=[];$(".charitable-donation-form").each((function(){forms.push(new CHARITABLE.Donation_Form($(this)))}));CHARITABLE.Toggle();CHARITABLE.ResetSuggestedDonations()}))})(jQuery);